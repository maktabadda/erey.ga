<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>erey.ga</title>

    <meta content="" name=description>
    <meta content=#212121 name=theme-color>
    <meta content="dark light" name=color-scheme>
    <meta content=#ffffff name=msapplication-TileColor>
    <meta content="width=device-width,initial-scale=1" name=viewport>
  
    <meta content=website property=og:type>
    <link href=stylesheet.css rel=stylesheet>

   </head>
<body>
    <div id="container">
        <h1>erey.ga</h1>
        <input type="text" id="wordInput" placeholder="maxaad raadin maanta?" onkeydown="if(event.keyCode===13) searchWord()">
        <button onclick="searchWord()">Raadi</button>
        <!-- <button onclick="listAllEntries()">List All Entries</button> -->
        <div id="definition"></div>
        <h2>Raadka Raadinta:</h2>
        <ul id="previousSearches"></ul>
        <button onclick="clearPreviousSearches()">Tirtir Raadka Raadinta</button>

        <hr>
        <footer>mashruucan wuxuu hoosyimaadaa <a href="https://maktabadda.com">maktabadda | Af-Soomaaliga</a></footer>
    </div>


    <script>
        let dictionaries = [];

        document.addEventListener('DOMContentLoaded', () => {
            fetch('dictionaries.json')
                .then(response => response.json())
                .then(data => {
                    dictionaries = data.dictionaries;
                    console.log('Abwaannada:', dictionaries);
                    loadPreviousSearches();
                })
                .catch(error => console.error('Error loading dictionaries:', error));
        });

        function searchWord(word = null) {
            const inputElement = document.getElementById("wordInput");
            const definitionDiv = document.getElementById("definition");
            const previousSearchesList = document.getElementById("previousSearches");

            definitionDiv.innerHTML = ""; // Clear previous result
            if (word === null) {
                word = inputElement.value.toLowerCase();
            }
            if(word === ""){
                console.log("Fadlan wax raadi!");
                const notFoundCardDiv = document.createElement("div");
                notFoundCardDiv.classList.add("not-found-card");
                notFoundCardDiv.textContent = `Ciyaarta naga daayee, fadlan wax raadi, Saaxiib!`;
                definitionDiv.appendChild(notFoundCardDiv);
                return;
            }
            else {
                word = word.toLowerCase();
            }
            inputElement.value = '';  // Clear the input field

            

            let previousSearches = JSON.parse(localStorage.getItem("previousSearches")) || [];
            if (!previousSearches.includes(word)) {
                previousSearches.push(word);
                localStorage.setItem("previousSearches", JSON.stringify(previousSearches));
            }

            previousSearchesList.innerHTML = "";
            previousSearches.forEach(search => {
                const listItem = document.createElement("li");
                listItem.textContent = search;
                listItem.onclick = () => searchWord(search);

                if (!isWordInDictionaries(search)) {
                    listItem.classList.add("not-found");
                }

                previousSearchesList.appendChild(listItem);
            });

            let wordFound = false;
            dictionaries.forEach(dictionary => {
                const lowerCaseDict = {};
                Object.keys(dictionary.data).forEach(key => {
                    lowerCaseDict[key.toLowerCase()] = dictionary.data[key];
                });

                if (lowerCaseDict[word]) {
                    const cardDiv = document.createElement("div");
                    cardDiv.classList.add("card");

                    const dictionaryNameDiv = document.createElement("div");
                    dictionaryNameDiv.classList.add("dictionary-name");
                    dictionaryNameDiv.textContent = dictionary.name;
                    cardDiv.appendChild(dictionaryNameDiv);

                    const wordTitleDiv = document.createElement("div");
                    wordTitleDiv.classList.add("word-title");
                    wordTitleDiv.textContent = `Erayga: ${word}`;
                    cardDiv.appendChild(wordTitleDiv);

                    lowerCaseDict[word].forEach(definition => {
                        const definitionTextDiv = document.createElement("div");
                        definitionTextDiv.classList.add("word-definition");
                        definitionTextDiv.textContent = definition;
                        cardDiv.appendChild(definitionTextDiv);
                    });

                    definitionDiv.appendChild(cardDiv);
                    wordFound = true;
                }
            });

            if (!wordFound) {
                const notFoundCardDiv = document.createElement("div");
                notFoundCardDiv.classList.add("not-found-card");
                notFoundCardDiv.textContent = `Erayga "${word}" lagama helin abwaannada aan hayno.`;
                definitionDiv.appendChild(notFoundCardDiv);
            }
        }

        function listAllEntries() {
            const definitionDiv = document.getElementById("definition");
            definitionDiv.innerHTML = ""; // Clear previous result

            dictionaries.forEach(dictionary => {
                Object.keys(dictionary.data).forEach(word => {
                    const cardDiv = document.createElement("div");
                    cardDiv.classList.add("card");

                    const dictionaryNameDiv = document.createElement("div");
                    dictionaryNameDiv.classList.add("dictionary-name");
                    dictionaryNameDiv.textContent = dictionary.name;
                    cardDiv.appendChild(dictionaryNameDiv);

                    const wordTitleDiv = document.createElement("div");
                    wordTitleDiv.classList.add("word-title");
                    wordTitleDiv.textContent = `Word: ${word}`;
                    cardDiv.appendChild(wordTitleDiv);

                    dictionary.data[word].forEach(definition => {
                        const definitionTextDiv = document.createElement("div");
                        definitionTextDiv.classList.add("word-definition");
                        definitionTextDiv.textContent = definition;
                        cardDiv.appendChild(definitionTextDiv);
                    });

                    definitionDiv.appendChild(cardDiv);
                });
            });
        }

        function clearPreviousSearches() {
            localStorage.removeItem("previousSearches");
            const previousSearchesList = document.getElementById("previousSearches");
            previousSearchesList.innerHTML = "";
        }

        function loadPreviousSearches() {
            const previousSearches = JSON.parse(localStorage.getItem("previousSearches")) || [];
            const previousSearchesList = document.getElementById("previousSearches");

            previousSearches.forEach(search => {
                const listItem = document.createElement("li");
                listItem.textContent = search;
                listItem.onclick = () => searchWord(search);

                if (!isWordInDictionaries(search)) {
                    listItem.classList.add("not-found");
                }

                previousSearchesList.appendChild(listItem);
            });
        }

        function isWordInDictionaries(word) {
            let wordFound = false;
            dictionaries.forEach(dictionary => {
                const lowerCaseDict = {};
                Object.keys(dictionary.data).forEach(key => {
                    lowerCaseDict[key.toLowerCase()] = dictionary.data[key];
                });

                if (lowerCaseDict[word.toLowerCase()]) {
                    wordFound = true;
                }
            });
            return wordFound;
        }
    </script>
</body>
</html>
